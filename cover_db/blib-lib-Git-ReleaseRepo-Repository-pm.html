<!DOCTYPE html
     PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
     "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<!--
This file was generated by Devel::Cover Version 1.04
Devel::Cover is copyright 2001-2012, Paul Johnson (paul@pjcj.net)
Devel::Cover is free. It is licensed under the same terms as Perl itself.
The latest version of Devel::Cover should be available from my homepage:
http://www.pjcj.net
-->
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"></meta>
    <meta http-equiv="Content-Language" content="en-us"></meta>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <link rel="stylesheet" type="text/css" href="cover.css"></link>
    <title>File Coverage: blib/lib/Git/ReleaseRepo/Repository.pm</title>
</head>
<body>
<h1>File Coverage</h1>
<table>
<tr><td class="h" align="right">File:</td><td align="left">blib/lib/Git/ReleaseRepo/Repository.pm</td></tr>
<tr><td class="h" align="right">Coverage:</td><td align="left" class="c1">86.8%</td></tr>
</table>
<div><br/></div>
<table>
<tr><th>line</th><th>stmt</th><th>bran</th><th>cond</th><th>sub</th><th>pod</th><th>time</th><th>code</th></tr>
<tr><td class="h">1</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">package Git::ReleaseRepo::Repository;</td></tr>
<tr><td class="h">2</td><td colspan="7"></td></tr><tr><td class="h">3</td><td><div class="c3">2</div><div class="c3">2</div><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L3">2</a></div></td><td></td><td><div>2074</div><div>2</div><div>6</div></td><td class="s">use Moose;</td></tr>
<tr><td class="h">4</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">extends &#39;Git::Repository::Plugin&#39;;</td></tr>
<tr><td class="h">5</td><td><div class="c3">2</div><div class="c3">2</div><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L5">2</a></div></td><td></td><td><div>7078</div><div>3</div><div>54</div></td><td class="s">use File::Path qw( remove_tree );</td></tr>
<tr><td class="h">6</td><td><div class="c3">2</div><div class="c3">2</div><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L6">2</a></div></td><td></td><td><div>4</div><div>2</div><div>1456</div></td><td class="s">use File::Spec::Functions qw( catfile catdir );</td></tr>
<tr><td class="h">7</td><td colspan="7"></td></tr><tr><td class="h">8</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># The list of subs to install into the object</td></tr>
<tr><td class="h">9</td><td><div class="c3">2</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L9">2</a></div></td><td></td><td><div>40</div></td><td class="s">sub _keywords { qw(</td></tr>
<tr><td class="h">10</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;submodule submodule_git outdated checkout list_version_refs</td></tr>
<tr><td class="h">11</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;list_versions latest_version list_release_branches latest_release_branch</td></tr>
<tr><td class="h">12</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;version_sort show_ref ls_remote has_remote has_branch release_prefix</td></tr>
<tr><td class="h">13</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;current_release</td></tr>
<tr><td class="h">14</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">) }</td></tr>
<tr><td class="h">15</td><td colspan="7"></td></tr><tr><td class="h">16</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># I do not like this, but I can&#39;t think of any better way to have a default</td></tr>
<tr><td class="h">17</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s"># that does the right thing and does what I mean</td></tr>
<tr><td class="h">18</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">has release_prefix =&gt; (</td></tr>
<tr><td class="h">19</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;is      =&gt; &#39;rw&#39;,</td></tr>
<tr><td class="h">20</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;isa     =&gt; &#39;Str&#39;,</td></tr>
<tr><td class="h">21</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;default =&gt; &#39;v&#39;,</td></tr>
<tr><td class="h">22</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">);</td></tr>
<tr><td class="h">23</td><td colspan="7"></td></tr><tr><td class="h">24</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub submodule {</td></tr>
<tr><td class="h">25</td><td><div class="c3">79</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L25">79</a></div></td><td><div class="c0">0</div></td><td><div>121</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self ) = @_;</td></tr>
<tr><td class="h">26</td><td><div class="c3">79</div></td><td></td><td></td><td></td><td></td><td><div>111</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %submodules;</td></tr>
<tr><td class="h">27</td><td><div class="c3">79</div></td><td></td><td></td><td></td><td></td><td><div>154</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $line ( $self-&gt;run( &#39;submodule&#39; ) ) {</td></tr>
<tr><td class="h">28</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# &lt;status&gt;&lt;SHA1 hash&gt; &lt;submodule&gt; (ref name)</td></tr>
<tr><td class="h">29</td><td><div class="c3">116</div></td><td></td><td></td><td></td><td></td><td><div>3981269</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$line =~ m{^.(\S+)\s(\S+)};</td></tr>
<tr><td class="h">30</td><td><div class="c3">116</div></td><td></td><td></td><td></td><td></td><td><div>852</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$submodules{ $2 } = $1;</td></tr>
<tr><td class="h">31</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">32</td><td><div class="c3">79</div></td><td><div class="c3" title="T/F"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--branch.html#L32">100</a></div></td><td></td><td></td><td></td><td><div>767</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return wantarray ? %submodules : \%submodules;</td></tr>
<tr><td class="h">33</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">34</td><td colspan="7"></td></tr><tr><td class="h">35</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub submodule_git {</td></tr>
<tr><td class="h">36</td><td><div class="c3">62</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L36">62</a></div></td><td><div class="c0">0</div></td><td><div>153</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $module ) = @_;</td></tr>
<tr><td class="h">37</td><td><div class="c3">62</div></td><td></td><td></td><td></td><td></td><td><div>308</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $git = Git::Repository-&gt;new(</td></tr>
<tr><td class="h">38</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;work_tree =&gt; catdir( $self-&gt;work_tree, $module ),</td></tr>
<tr><td class="h">39</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;);</td></tr>
<tr><td class="h">40</td><td><div class="c3">62</div></td><td></td><td></td><td></td><td></td><td><div>1225836</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$git-&gt;release_prefix( $self-&gt;release_prefix );</td></tr>
<tr><td class="h">41</td><td><div class="c3">62</div></td><td></td><td></td><td></td><td></td><td><div>270</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $git;</td></tr>
<tr><td class="h">42</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">43</td><td colspan="7"></td></tr><tr><td class="h">44</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub outdated {</td></tr>
<tr><td class="h">45</td><td><div class="c3">35</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L45">35</a></div></td><td><div class="c0">0</div></td><td><div>80</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $ref ) = @_;</td></tr>
<tr><td class="h">46</td><td><div class="c3">35</div></td><td></td><td><div class="c0"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--condition.html#L46">50</a></div></td><td></td><td></td><td><div>79</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$ref ||= &quot;refs/heads/master&quot;;</td></tr>
<tr><td class="h">47</td><td><div class="c3">35</div></td><td></td><td></td><td></td><td></td><td><div>99</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %submod_refs = $self-&gt;submodule;</td></tr>
<tr><td class="h">48</td><td><div class="c3">35</div></td><td></td><td></td><td></td><td></td><td><div>95</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @outdated;</td></tr>
<tr><td class="h">49</td><td><div class="c3">35</div></td><td></td><td></td><td></td><td></td><td><div>95</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $submod ( keys %submod_refs ) {</td></tr>
<tr><td class="h">50</td><td><div class="c3">53</div></td><td></td><td></td><td></td><td></td><td><div>211</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my $subgit = $self-&gt;submodule_git( $submod );</td></tr>
<tr><td class="h">51</td><td><div class="c3">53</div></td><td></td><td></td><td></td><td></td><td><div>249</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my %remote = $subgit-&gt;ls_remote;</td></tr>
<tr><td class="h">52</td><td><div class="c3">53</div></td><td><div class="c3" title="T/F"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--branch.html#L52">100</a></div></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--condition.html#L52">100</a></div></td><td></td><td></td><td><div>597</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( !exists $remote{ $ref } || $submod_refs{ $submod } ne $remote{$ref} ) {</td></tr>
<tr><td class="h">53</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#print &quot;OUTDATED $submod: $submod_refs{$submod} ne $remote{$ref}\n&quot;;</td></tr>
<tr><td class="h">54</td><td><div class="c3">7</div></td><td></td><td></td><td></td><td></td><td><div>63</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @outdated, $submod;</td></tr>
<tr><td class="h">55</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">56</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">57</td><td><div class="c3">35</div></td><td></td><td></td><td></td><td></td><td><div>285</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return @outdated;</td></tr>
<tr><td class="h">58</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">59</td><td colspan="7"></td></tr><tr><td class="h">60</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub checkout {</td></tr>
<tr><td class="h">61</td><td><div class="c3">34</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L61">34</a></div></td><td><div class="c0">0</div></td><td><div>94</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $commit ) = @_;</td></tr>
<tr><td class="h">62</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# git will not remove submodule directories, in case they have stuff in them</td></tr>
<tr><td class="h">63</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# So let&#39;s compare the list and see what we need to remove</td></tr>
<tr><td class="h">64</td><td><div class="c3">34</div></td><td></td><td></td><td></td><td></td><td><div>116</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %current_submodule = $self-&gt;submodule;</td></tr>
<tr><td class="h">65</td><td><div class="c3">34</div></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--condition.html#L65">100</a></div></td><td></td><td></td><td><div>206</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$commit //= &quot;master&quot;;</td></tr>
<tr><td class="h">66</td><td><div class="c3">34</div></td><td></td><td></td><td></td><td></td><td><div>117</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $cmd = $self-&gt;command( checkout =&gt; $commit );</td></tr>
<tr><td class="h">67</td><td><div class="c3">34</div></td><td></td><td></td><td></td><td></td><td><div>154253</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @stderr = readline $cmd-&gt;stderr;</td></tr>
<tr><td class="h">68</td><td><div class="c3">34</div></td><td></td><td></td><td></td><td></td><td><div>199409</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @stdout = readline $cmd-&gt;stdout;</td></tr>
<tr><td class="h">69</td><td><div class="c3">34</div></td><td></td><td></td><td></td><td></td><td><div>340</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$cmd-&gt;close;</td></tr>
<tr><td class="h">70</td><td><div class="c3">34</div></td><td><div class="c0" title="-/F"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--branch.html#L70">50</a></div></td><td></td><td></td><td></td><td><div>1892</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $cmd-&gt;exit != 0 ) {</td></tr>
<tr><td class="h">71</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die &quot;Could not checkout &#39;$commit&#39;.\nEXIT: &quot; . $cmd-&gt;exit . &quot;\nSTDERR: &quot; . ( join &quot;\n&quot;, @stderr )</td></tr>
<tr><td class="h">72</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;. &quot;\nSTDOUT: &quot; . ( join &quot;\n&quot;, @stdout );</td></tr>
<tr><td class="h">73</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">74</td><td><div class="c3">34</div></td><td></td><td></td><td></td><td></td><td><div>219</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$cmd = $self-&gt;command( submodule =&gt; update =&gt; &#39;--init&#39; );</td></tr>
<tr><td class="h">75</td><td><div class="c3">34</div></td><td></td><td></td><td></td><td></td><td><div>149576</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@stderr = readline $cmd-&gt;stderr;</td></tr>
<tr><td class="h">76</td><td><div class="c3">34</div></td><td></td><td></td><td></td><td></td><td><div>2132286</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;@stdout = readline $cmd-&gt;stdout;</td></tr>
<tr><td class="h">77</td><td><div class="c3">34</div></td><td></td><td></td><td></td><td></td><td><div>503</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$cmd-&gt;close;</td></tr>
<tr><td class="h">78</td><td><div class="c3">34</div></td><td><div class="c0" title="-/F"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--branch.html#L78">50</a></div></td><td></td><td></td><td></td><td><div>2416</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;if ( $cmd-&gt;exit != 0 ) {</td></tr>
<tr><td class="h">79</td><td><div class="c0">0</div></td><td></td><td></td><td></td><td></td><td><div>0</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die &quot;Could not update submodules to &#39;$commit&#39;.\nEXIT: &quot; . $cmd-&gt;exit . &quot;\nSTDERR: &quot; . ( join &quot;\n&quot;, @stderr )</td></tr>
<tr><td class="h">80</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;. &quot;\nSTDOUT: &quot; . ( join &quot;\n&quot;, @stdout );</td></tr>
<tr><td class="h">81</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">82</td><td colspan="7"></td></tr><tr><td class="h">83</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Remove any submodule directories that no longer belong</td></tr>
<tr><td class="h">84</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>6</div><div>6</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @missing = grep { exists $current_submodule{ $_ } }</td></tr>
<tr><td class="h">85</td><td><div class="c3">1</div><div class="c3">1</div></td><td></td><td></td><td></td><td></td><td><div>5</div><div>9873</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;map { s{^[?]*\s+|/$}{}g; $_ }</td></tr>
<tr><td class="h">86</td><td><div class="c3">34</div></td><td></td><td></td><td></td><td></td><td><div>263</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;grep { /^[?]{2}/ }</td></tr>
<tr><td class="h">87</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;run( status =&gt; &#39;--porcelain&#39; );</td></tr>
<tr><td class="h">88</td><td><div class="c3">34</div></td><td></td><td></td><td></td><td></td><td><div>377975</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;remove_tree( catdir( $self-&gt;work_tree, $_ ) ) for @missing;</td></tr>
<tr><td class="h">89</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">90</td><td colspan="7"></td></tr><tr><td class="h">91</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub list_version_refs {</td></tr>
<tr><td class="h">92</td><td><div class="c3">44</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L92">44</a></div></td><td><div class="c0">0</div></td><td><div>96</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $match, $rel_branch ) = @_;</td></tr>
<tr><td class="h">93</td><td><div class="c3">44</div></td><td></td><td><div class="c0"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--condition.html#L93">67</a></div></td><td></td><td></td><td><div>1135</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $prefix = $rel_branch // $self-&gt;release_prefix;</td></tr>
<tr><td class="h">94</td><td><div class="c3">44</div></td><td><div class="c3" title="T/F"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--branch.html#L94">100</a></div></td><td></td><td></td><td></td><td><div>188</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %refs = $self-&gt;has_remote( &#39;origin&#39;) ? $self-&gt;ls_remote( &#39;origin&#39; ) : $self-&gt;show_ref;</td></tr>
<tr><td class="h">95</td><td><div class="c3">44</div><div class="c3">109</div><div class="c3">109</div><div class="c3">252</div></td><td></td><td></td><td></td><td></td><td><div>124</div><div>717</div><div>226</div><div>849</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @versions = reverse sort version_sort grep { m{^$prefix} } map { (split &quot;/&quot;, $_)[-1] } grep { m{^refs/$match/} } keys %refs;</td></tr>
<tr><td class="h">96</td><td><div class="c3">44</div></td><td></td><td></td><td></td><td></td><td><div>231</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return @versions;</td></tr>
<tr><td class="h">97</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">98</td><td colspan="7"></td></tr><tr><td class="h">99</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub list_versions {</td></tr>
<tr><td class="h">100</td><td><div class="c3">20</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L100">20</a></div></td><td><div class="c0">0</div></td><td><div>30</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $rel_branch ) = @_;</td></tr>
<tr><td class="h">101</td><td><div class="c3">20</div></td><td></td><td></td><td></td><td></td><td><div>61</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;list_version_refs( &#39;tags&#39;, $rel_branch );</td></tr>
<tr><td class="h">102</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">103</td><td colspan="7"></td></tr><tr><td class="h">104</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub latest_version {</td></tr>
<tr><td class="h">105</td><td><div class="c3">20</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L105">20</a></div></td><td><div class="c0">0</div></td><td><div>57</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $rel_branch ) = @_;</td></tr>
<tr><td class="h">106</td><td><div class="c3">20</div></td><td></td><td></td><td></td><td></td><td><div>62</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @versions = $self-&gt;list_versions( $rel_branch );</td></tr>
<tr><td class="h">107</td><td><div class="c3">20</div></td><td></td><td></td><td></td><td></td><td><div>82</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $versions[0];</td></tr>
<tr><td class="h">108</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">109</td><td colspan="7"></td></tr><tr><td class="h">110</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub list_release_branches {</td></tr>
<tr><td class="h">111</td><td><div class="c3">24</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L111">24</a></div></td><td><div class="c0">0</div></td><td><div>37</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self ) = @_;</td></tr>
<tr><td class="h">112</td><td><div class="c3">24</div></td><td></td><td></td><td></td><td></td><td><div>58</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $self-&gt;list_version_refs( &#39;heads&#39; );</td></tr>
<tr><td class="h">113</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">114</td><td colspan="7"></td></tr><tr><td class="h">115</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub latest_release_branch {</td></tr>
<tr><td class="h">116</td><td><div class="c3">24</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L116">24</a></div></td><td><div class="c0">0</div></td><td><div>44</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self ) = @_;</td></tr>
<tr><td class="h">117</td><td><div class="c3">24</div></td><td></td><td></td><td></td><td></td><td><div>80</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @branches = $self-&gt;list_release_branches;</td></tr>
<tr><td class="h">118</td><td><div class="c3">24</div></td><td></td><td></td><td></td><td></td><td><div>79</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $branches[0];</td></tr>
<tr><td class="h">119</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">120</td><td colspan="7"></td></tr><tr><td class="h">121</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub version_sort {</td></tr>
<tr><td class="h">122</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Assume Semantic Versioning style, plus prefix</td></tr>
<tr><td class="h">123</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# %s.%i.%i%s</td></tr>
<tr><td class="h">124</td><td><div class="c3">25</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L124">25</a></div></td><td><div class="c0">0</div></td><td><div>187</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @a = $a =~ /^\D*(\d+)[.](\d+)(?:[.](\d+))?/;</td></tr>
<tr><td class="h">125</td><td><div class="c3">25</div></td><td></td><td></td><td></td><td></td><td><div>84</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @b = $b =~ /^\D*(\d+)[.](\d+)(?:[.](\d+))?/;</td></tr>
<tr><td class="h">126</td><td colspan="7"></td></tr><tr><td class="h">127</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;# Assume the 3rd number is 0 if not given</td></tr>
<tr><td class="h">128</td><td><div class="c3">25</div></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--condition.html#L128">100</a></div></td><td></td><td></td><td><div>95</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$a[2] //= 0;</td></tr>
<tr><td class="h">129</td><td><div class="c3">25</div></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--condition.html#L129">100</a></div></td><td></td><td></td><td><div>69</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$b[2] //= 0;</td></tr>
<tr><td class="h">130</td><td colspan="7"></td></tr><tr><td class="h">131</td><td><div class="c3">25</div></td><td></td><td></td><td></td><td></td><td><div>61</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $format = ( &quot;%03i&quot; x @a );</td></tr>
<tr><td class="h">132</td><td><div class="c3">25</div></td><td></td><td></td><td></td><td></td><td><div>233</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return sprintf( $format, @a ) cmp sprintf( $format, @b );</td></tr>
<tr><td class="h">133</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">134</td><td colspan="7"></td></tr><tr><td class="h">135</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub show_ref {</td></tr>
<tr><td class="h">136</td><td><div class="c3">46</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L136">46</a></div></td><td><div class="c0">0</div></td><td><div>196625</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self ) = @_;</td></tr>
<tr><td class="h">137</td><td><div class="c3">46</div></td><td></td><td></td><td></td><td></td><td><div>115</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %refs;</td></tr>
<tr><td class="h">138</td><td><div class="c3">46</div></td><td></td><td></td><td></td><td></td><td><div>171</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $cmd = $self-&gt;command( &#39;show-ref&#39;, &#39;--head&#39; );</td></tr>
<tr><td class="h">139</td><td><div class="c3">46</div></td><td></td><td></td><td></td><td></td><td><div>202131</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;while ( defined( my $line = readline $cmd-&gt;stdout ) ) {</td></tr>
<tr><td class="h">140</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# &lt;SHA1 hash&gt; &lt;symbolic ref&gt;</td></tr>
<tr><td class="h">141</td><td><div class="c3">291</div></td><td></td><td></td><td></td><td></td><td><div>53011</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $ref_id, $ref_name ) = split /\s+/, $line;</td></tr>
<tr><td class="h">142</td><td><div class="c3">291</div></td><td></td><td></td><td></td><td></td><td><div>857</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$refs{ $ref_name } = $ref_id;</td></tr>
<tr><td class="h">143</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">144</td><td><div class="c3">46</div></td><td><div class="c0" title="T/-"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--branch.html#L144">50</a></div></td><td></td><td></td><td></td><td><div>3033</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return wantarray ? %refs : \%refs;</td></tr>
<tr><td class="h">145</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">146</td><td colspan="7"></td></tr><tr><td class="h">147</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub ls_remote {</td></tr>
<tr><td class="h">148</td><td><div class="c3">63</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L148">63</a></div></td><td><div class="c0">0</div></td><td><div>103</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self ) = @_;</td></tr>
<tr><td class="h">149</td><td><div class="c3">63</div></td><td></td><td></td><td></td><td></td><td><div>101</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %refs;</td></tr>
<tr><td class="h">150</td><td><div class="c3">63</div></td><td></td><td></td><td></td><td></td><td><div>206</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $cmd = $self-&gt;command( &#39;ls-remote&#39;, &#39;origin&#39; );</td></tr>
<tr><td class="h">151</td><td><div class="c3">63</div></td><td></td><td></td><td></td><td></td><td><div>279275</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;while ( defined( my $line = readline $cmd-&gt;stdout ) ) {</td></tr>
<tr><td class="h">152</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;# &lt;SHA1 hash&gt; &lt;symbolic ref&gt;</td></tr>
<tr><td class="h">153</td><td><div class="c3">335</div></td><td></td><td></td><td></td><td></td><td><div>243419</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $ref_id, $ref_name ) = split /\s+/, $line;</td></tr>
<tr><td class="h">154</td><td><div class="c3">335</div></td><td></td><td></td><td></td><td></td><td><div>1054</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$refs{ $ref_name } = $ref_id;</td></tr>
<tr><td class="h">155</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">156</td><td><div class="c3">63</div></td><td><div class="c0" title="T/-"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--branch.html#L156">50</a></div></td><td></td><td></td><td></td><td><div>3222</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return wantarray ? %refs : \%refs;</td></tr>
<tr><td class="h">157</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">158</td><td colspan="7"></td></tr><tr><td class="h">159</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub has_remote {</td></tr>
<tr><td class="h">160</td><td><div class="c3">59</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L160">59</a></div></td><td><div class="c0">0</div></td><td><div>127</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $name ) = @_;</td></tr>
<tr><td class="h">161</td><td><div class="c3">59</div><div class="c3">19</div></td><td></td><td></td><td></td><td></td><td><div>157</div><div>108472</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return grep { $_ eq $name } $self-&gt;run( &#39;remote&#39; );</td></tr>
<tr><td class="h">162</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">163</td><td colspan="7"></td></tr><tr><td class="h">164</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub has_branch {</td></tr>
<tr><td class="h">165</td><td><div class="c3">5</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L165">5</a></div></td><td><div class="c0">0</div></td><td><div>11</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self, $name ) = @_;</td></tr>
<tr><td class="h">166</td><td><div class="c3">5</div><div class="c3">8</div><div class="c3">8</div><div class="c3">8</div></td><td></td><td></td><td></td><td></td><td><div>11</div><div>28</div><div>23940</div><div>22</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return grep { $_ eq $name } map { s/[*]?\s+//; $_ } $self-&gt;run( &#39;branch&#39; );</td></tr>
<tr><td class="h">167</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">168</td><td colspan="7"></td></tr><tr><td class="h">169</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">sub current_release {</td></tr>
<tr><td class="h">170</td><td><div class="c3">12</div></td><td></td><td></td><td><div class="c3"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--subroutine.html#L170">12</a></div></td><td><div class="c0">0</div></td><td><div>18</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my ( $self ) = @_;</td></tr>
<tr><td class="h">171</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td></td><td><div>29</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;$self-&gt;command( &#39;fetch&#39;, &#39;--tags&#39; );</td></tr>
<tr><td class="h">172</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td></td><td><div>51845</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my %ref = $self-&gt;show_ref;</td></tr>
<tr><td class="h">173</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td></td><td><div>36</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my @tags = ();</td></tr>
<tr><td class="h">174</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#    ; use Data::Dumper;</td></tr>
<tr><td class="h">175</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#    ; warn Dumper \%ref;</td></tr>
<tr><td class="h">176</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td></td><td><div>39</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;for my $key ( keys %ref ) {</td></tr>
<tr><td class="h">177</td><td><div class="c3">114</div></td><td><div class="c3" title="T/F"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--branch.html#L177">100</a></div></td><td></td><td></td><td></td><td><div>215</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;next unless $key =~ m{^refs/tags};</td></tr>
<tr><td class="h">178</td><td><div class="c3">42</div></td><td><div class="c3" title="T/F"><a href="blib-lib-Git-ReleaseRepo-Repository-pm--branch.html#L178">100</a></div></td><td></td><td></td><td></td><td><div>64</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if ( $ref{$key} eq $ref{HEAD} ) {</td></tr>
<tr><td class="h">179</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td></td><td><div>60</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;my ( $tag ) = $key =~ m{/([^/]+)$};</td></tr>
<tr><td class="h">180</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td></td><td><div>23</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;push @tags, $tag;</td></tr>
<tr><td class="h">181</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">182</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;}</td></tr>
<tr><td class="h">183</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#    ; warn &quot;Found: &quot; . Dumper \@tags;</td></tr>
<tr><td class="h">184</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td></td><td><div>51</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;my $version = [ sort version_sort @tags ]-&gt;[0];</td></tr>
<tr><td class="h">185</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">#    ; warn &quot;Current release: $version&quot;;</td></tr>
<tr><td class="h">186</td><td><div class="c3">12</div></td><td></td><td></td><td></td><td></td><td><div>62</div></td><td class="s">&nbsp;&nbsp;&nbsp;&nbsp;return $version;</td></tr>
<tr><td class="h">187</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">}</td></tr>
<tr><td class="h">188</td><td colspan="7"></td></tr><tr><td class="h">189</td><td></td><td></td><td></td><td></td><td></td><td></td><td class="s">1;</td></tr>
</table>
</body>
</html>
